# 小智服务器网页测试配置指南

## 概述
这个测试页面用于在没有真实硬件设备的情况下测试小智服务器的功能。

## 快速配置步骤

### 1. 启动服务
确保以下服务正在运行：
- **manager-api** (Java后端，端口8002)
- **xiaozhi-server** (Python服务，端口8000)

### 2. 配置智控台参数

登录智控台（管理后台），配置以下参数：

#### 参数1：server.websocket
- **参数编码**：`server.websocket`
- **参数值**：`ws://127.0.0.1:8000/xiaozhi/v1/`
- **说明**：WebSocket服务器地址

#### 参数2：server.ota
- **参数编码**：`server.ota`
- **参数值**：`http://127.0.0.1:8002/xiaozhi/ota/`
- **说明**：OTA服务器地址

### 3. 添加测试固件

在智控台中：
1. 进入 `设备管理` → `OTA固件管理`
2. 点击 `新增`
3. 填写以下信息：
   - **固件名称**：`Web测试固件`
   - **固件类型**：`xiaozhi-web-test`（必须与测试页面一致）
   - **版本号**：`1.0.1`（比测试页面的1.0.0更高）
   - **备注**：`Web测试用固件`

### 4. 验证配置

1. 打开测试页面：`http://127.0.0.1:8000/test/test_page.html`
2. 点击 `快速配置检查` 按钮
3. 查看检查结果，确保所有项目都显示 ✓

### 5. 开始测试

1. 点击 `连接` 按钮
2. 如果看到激活码，这是正常的（新设备需要激活）
3. 开始进行文本或语音对话测试

## 常见问题

### Q: 显示"没有找到该设备的版本信息"
**A**: 请检查：
1. 是否已配置 `server.ota` 参数
2. 是否已添加固件类型为 `xiaozhi-web-test` 的固件
3. 固件版本是否比测试页面的1.0.0更高

### Q: OTA接口检查失败
**A**: 请检查：
1. manager-api服务是否正在运行
2. 端口8002是否被占用
3. 防火墙是否阻止了连接

### Q: WebSocket连接失败
**A**: 请检查：
1. xiaozhi-server服务是否正在运行
2. 端口8000是否被占用
3. 是否已配置 `server.websocket` 参数

### Q: 需要激活码
**A**: 这是正常的，因为这是一个新的测试设备。激活码用于：
1. 在智控台中手动添加设备
2. 或者通过API激活设备

## 测试功能

### 文本对话
1. 切换到"文本消息"标签页
2. 在输入框中输入消息
3. 点击"发送"按钮

### 语音对话
1. 切换到"语音消息"标签页
2. 点击"开始录音"按钮
3. 说话后点击"停止录音"

### 设备管理
1. 点击"编辑"按钮可以修改设备配置
2. 可以修改设备MAC地址、名称等
3. 配置会保存在浏览器本地存储中

## 技术说明

### 设备模拟
测试页面模拟了一个ESP32设备的行为：
- 使用随机生成的MAC地址
- 发送标准的OTA请求格式
- 支持WebSocket通信协议

### 音频处理
- 使用Web Audio API录制音频
- 使用Opus编码压缩音频数据
- 支持实时音频可视化

### 错误处理
- 详细的错误日志显示
- 自动重连机制
- 配置检查功能
