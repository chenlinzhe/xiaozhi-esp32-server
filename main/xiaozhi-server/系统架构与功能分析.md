# å°æ™ºESP32æœåŠ¡å™¨ - ç³»ç»Ÿæ¶æ„ä¸åŠŸèƒ½åˆ†æ

## ğŸ“ ç³»ç»Ÿæ•´ä½“æ¶æ„å›¾

```mermaid
graph TB
    subgraph "å®¢æˆ·ç«¯å±‚"
        Client[ESP32è®¾å¤‡<br/>éŸ³é¢‘è¾“å…¥/è¾“å‡º]
    end
    
    subgraph "è¿æ¥ç®¡ç†å±‚"
        ConnHandler[ConnectionHandler<br/>WebSocketè¿æ¥ç®¡ç†<br/>éŸ³é¢‘æµå¤„ç†]
        ConnHandler --> VAD[VADè¯­éŸ³æ£€æµ‹]
        ConnHandler --> ASR[ASRè¯­éŸ³è¯†åˆ«]
        ConnHandler --> TTS[TTSè¯­éŸ³åˆæˆ]
        ConnHandler --> LLM[LLMå¤§è¯­è¨€æ¨¡å‹]
        ConnHandler --> Memory[è®°å¿†ç®¡ç†]
        ConnHandler --> Intent[æ„å›¾è¯†åˆ«]
    end
    
    subgraph "æ•™å­¦åœºæ™¯ç³»ç»Ÿ"
        TeachingHandler[TeachingHandler<br/>æ•™å­¦å¤„ç†å™¨<br/>æ¶ˆæ¯å‘é€ç®¡ç†]
        StatusManager[ChatStatusManager<br/>èŠå¤©çŠ¶æ€ç®¡ç†<br/>ç”¨æˆ·è¾“å…¥å¤„ç†<br/>å›å¤è¯„ä¼°]
        DialogueService[DialogueService<br/>å¯¹è¯æœåŠ¡<br/>APIäº¤äº’]
        ScenarioMgr[ScenarioManager<br/>åœºæ™¯ç®¡ç†<br/>æ­¥éª¤ç®¡ç†]
        LearnRecordMgr[LearningRecordManager<br/>å­¦ä¹ è®°å½•ç®¡ç†]
        DialogueExecutor[DialogueExecutor<br/>å¯¹è¯æ‰§è¡Œå™¨<br/>åœºæ™¯è§¦å‘]
    end
    
    subgraph "æ•°æ®å­˜å‚¨å±‚"
        Redis[(Redis<br/>ä¼šè¯æ•°æ®<br/>èŠå¤©çŠ¶æ€)]
        DB[(æ•°æ®åº“<br/>ç”¨æˆ·ä¿¡æ¯<br/>åœºæ™¯é…ç½®)]
        API[(ç®¡ç†API<br/>åœºæ™¯æ­¥éª¤<br/>å­¦ä¹ è®°å½•)]
    end
    
    Client <-->|WebSocket| ConnHandler
    ConnHandler --> TeachingHandler
    TeachingHandler --> StatusManager
    StatusManager --> DialogueService
    StatusManager --> Redis
    DialogueService --> API
    ScenarioMgr --> API
    LearnRecordMgr --> API
    DialogueExecutor --> ScenarioMgr
    ConnHandler --> DB
    
    style ConnHandler fill:#e1f5ff
    style TeachingHandler fill:#fff4e1
    style StatusManager fill:#e1ffe1
    style DialogueService fill:#f0e1ff
```

## ğŸ—ï¸ æ ¸å¿ƒæ¨¡å—åŠŸèƒ½åˆ†æ

### 1. ConnectionHandler (è¿æ¥å¤„ç†å™¨)

**æ–‡ä»¶**: `core/connection.py`

**æ ¸å¿ƒèŒè´£**:
- WebSocketè¿æ¥ç®¡ç†
- éŸ³é¢‘æµæ¥æ”¶å’Œå‘é€
- ç»„ä»¶åˆå§‹åŒ–ï¼ˆVADã€ASRã€TTSã€LLMï¼‰
- ç”¨æˆ·è®¤è¯å’Œè®¾å¤‡ç»‘å®š
- å¯¹è¯å†å²ç®¡ç†
- ä¸TeachingHandleré›†æˆ

**å…³é”®å±æ€§**:
```python
- websocket: WebSocketè¿æ¥
- device_id: è®¾å¤‡ID
- session_id: ä¼šè¯ID
- child_name: å„¿ç«¥å§“å
- teaching_handler: TeachingHandlerå®ä¾‹
- vad/asr/tts/llm: å„ç»„ä»¶å®ä¾‹
- dialogue: å¯¹è¯å†å²
- llm_finish_task: LLMä»»åŠ¡å®Œæˆæ ‡å¿—
```

**å…³é”®æ–¹æ³•**:
- `handle_connection()`: å¤„ç†WebSocketè¿æ¥
- `chat()`: å¤„ç†èŠå¤©é€»è¾‘
- `_handle_chat_mode()`: å¤„ç†èŠå¤©æ¨¡å¼åˆ‡æ¢
- `_send_welcome_voice()`: å‘é€æ¬¢è¿è¯­éŸ³

### 2. TeachingHandler (æ•™å­¦å¤„ç†å™¨)

**æ–‡ä»¶**: `core/scenario/teaching_handler.py`

**æ ¸å¿ƒèŒè´£**:
- å¤„ç†èŠå¤©æ¨¡å¼åˆ‡æ¢å’Œæ•™å­¦æ¨¡å¼é€»è¾‘
- å‘é€TTSæ¶ˆæ¯ï¼ˆå•æ¡æ¶ˆæ¯å’Œæ¶ˆæ¯åˆ—è¡¨ï¼‰
- ç®¡ç†TTSä¼šè¯ç”Ÿå‘½å‘¨æœŸ
- ä¸ChatStatusManageråä½œå¤„ç†æ•™å­¦æµç¨‹

**å…³é”®æ–¹æ³•**:
```python
- handle_chat_mode(): å¤„ç†èŠå¤©æ¨¡å¼åˆ‡æ¢
- _send_tts_message(): å‘é€å•æ¡TTSæ¶ˆæ¯
- _send_message_list(): å‘é€æ¶ˆæ¯åˆ—è¡¨
- _end_tts_session(): ç»“æŸTTSä¼šè¯
- _calculate_speech_duration(): è®¡ç®—è¯­éŸ³æ’­æ”¾æ—¶é•¿
```

**å¤„ç†æµç¨‹**:
```
æ¥æ”¶actionç±»å‹
â”œâ”€â”€ start_teaching â†’ å‘é€ç¬¬ä¸€æ­¥æ¶ˆæ¯
â”œâ”€â”€ perfect_match_next/partial_match_next/no_match_next â†’ å¤„ç†æ­¥éª¤è·³è½¬
â”œâ”€â”€ retry_current_step â†’ å¤„ç†é‡è¯•
â””â”€â”€ completed â†’ å¤„ç†å®Œæˆï¼Œåˆ‡æ¢è‡ªç”±æ¨¡å¼
```

### 3. ChatStatusManager (èŠå¤©çŠ¶æ€ç®¡ç†å™¨)

**æ–‡ä»¶**: `core/scenario/chat_status_manager.py`

**æ ¸å¿ƒèŒè´£**:
- ç®¡ç†ç”¨æˆ·èŠå¤©çŠ¶æ€ï¼ˆteaching_mode/free_modeï¼‰
- å¤„ç†ç”¨æˆ·è¾“å…¥å’Œæ•™å­¦å›å¤
- è¯„ä¼°ç”¨æˆ·å›å¤ï¼ˆå®Œå…¨åŒ¹é…/éƒ¨åˆ†åŒ¹é…/å®Œå…¨ä¸åŒ¹é…ï¼‰
- ç®¡ç†æ•™å­¦ä¼šè¯æ•°æ®ï¼ˆRedisï¼‰
- æ­¥éª¤è·³è½¬é€»è¾‘ï¼ˆå¶å­èŠ‚ç‚¹/éå¶å­èŠ‚ç‚¹ï¼‰

**å…³é”®æ–¹æ³•**:
```python
- handle_user_input(): å¤„ç†ç”¨æˆ·è¾“å…¥ï¼ˆå…¥å£ï¼‰
- _handle_teaching_mode(): å¤„ç†æ•™å­¦æ¨¡å¼
- _handle_free_mode(): å¤„ç†è‡ªç”±æ¨¡å¼
- _start_teaching_session(): å¼€å§‹æ•™å­¦ä¼šè¯
- _process_teaching_response(): å¤„ç†æ•™å­¦å›å¤
- _evaluate_response_with_config(): è¯„ä¼°ç”¨æˆ·å›å¤
- _is_leaf_step(): åˆ¤æ–­æ˜¯å¦ä¸ºå¶å­èŠ‚ç‚¹
- _get_step_max_attempts(): è·å–æ­¥éª¤æœ€å¤§å°è¯•æ¬¡æ•°
```

**è¯„ä¼°é€»è¾‘**:
```
å®Œå…¨åŒ¹é…ï¼ˆscore >= 90ï¼‰:
â”œâ”€â”€ åŒ…å«æœŸæœ›çŸ­è¯­ï¼ˆæ–‡å­—åŒ¹é…ï¼‰
â””â”€â”€ åŒ…å«æœŸæœ›çŸ­è¯­ï¼ˆæ‹¼éŸ³åŒ¹é…ï¼‰

éƒ¨åˆ†åŒ¹é…ï¼ˆ60 <= score < 90ï¼‰:
â”œâ”€â”€ åŒ…å«æœŸæœ›å…³é”®è¯ï¼ˆæ–‡å­—åŒ¹é…ï¼‰
â””â”€â”€ åŒ…å«æœŸæœ›å…³é”®è¯ï¼ˆæ‹¼éŸ³åŒ¹é…ï¼‰

å®Œå…¨ä¸åŒ¹é…ï¼ˆscore < 60ï¼‰:
â””â”€â”€ ä¸åŒ…å«ä»»ä½•æœŸæœ›çŸ­è¯­æˆ–å…³é”®è¯
```

**æ­¥éª¤è·³è½¬é€»è¾‘**:
```
éå¶å­èŠ‚ç‚¹:
â”œâ”€â”€ å®Œå…¨åŒ¹é… â†’ perfectMatchNextStepId
â”œâ”€â”€ éƒ¨åˆ†åŒ¹é… â†’ partialMatchNextStepId
â””â”€â”€ å®Œå…¨ä¸åŒ¹é… â†’ noMatchNextStepId

å¶å­èŠ‚ç‚¹:
â”œâ”€â”€ é‡è¯•æ¬¡æ•° < max_attempts â†’ é‡å¤å½“å‰æ­¥éª¤
â””â”€â”€ é‡è¯•æ¬¡æ•° >= max_attempts â†’ æ•™å­¦å®Œæˆ
```

### 4. DialogueService (å¯¹è¯æœåŠ¡)

**æ–‡ä»¶**: `core/scenario/dialogue_service.py`

**æ ¸å¿ƒèŒè´£**:
- ä¸ç®¡ç†APIäº¤äº’
- è·å–åœºæ™¯å’Œæ­¥éª¤æ•°æ®
- åˆ›å»ºæ•™å­¦ä¼šè¯
- è·å–æ­¥éª¤æ¶ˆæ¯åˆ—è¡¨

**å…³é”®æ–¹æ³•**:
```python
- start_scenario(): å¼€å§‹åœºæ™¯å¯¹è¯
- _get_scenario_steps(): è·å–åœºæ™¯æ­¥éª¤
- _get_step_message_list(): è·å–æ­¥éª¤æ¶ˆæ¯åˆ—è¡¨
```

### 5. ScenarioManager (åœºæ™¯ç®¡ç†å™¨)

**æ–‡ä»¶**: `core/scenario/scenario_manager.py`

**æ ¸å¿ƒèŒè´£**:
- ç®¡ç†å­¦ä¹ åœºæ™¯ï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰
- ç®¡ç†åœºæ™¯æ­¥éª¤ï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰
- è·å–æ´»è·ƒåœºæ™¯åˆ—è¡¨

**å…³é”®ç±»**:
- `ScenarioManager`: åœºæ™¯ç®¡ç†
- `StepManager`: æ­¥éª¤ç®¡ç†

### 6. LearningRecordManager (å­¦ä¹ è®°å½•ç®¡ç†å™¨)

**æ–‡ä»¶**: `core/scenario/learning_record_manager.py`

**æ ¸å¿ƒèŒè´£**:
- ä¿å­˜å­¦ä¹ è®°å½•åˆ°API
- ç®¡ç†å­¦ä¹ ä¼šè¯

**å…³é”®ç±»**:
- `LearningRecordManager`: å­¦ä¹ è®°å½•ç®¡ç†
- `LearningSession`: å­¦ä¹ ä¼šè¯ç®¡ç†

### 7. DialogueExecutor (å¯¹è¯æ‰§è¡Œå™¨)

**æ–‡ä»¶**: `core/scenario/dialogue_executor.py`

**æ ¸å¿ƒèŒè´£**:
- æ‰§è¡Œåœºæ™¯å¯¹è¯æ­¥éª¤
- åœºæ™¯è§¦å‘æ£€æµ‹

**å…³é”®ç±»**:
- `DialogueStepExecutor`: å¯¹è¯æ­¥éª¤æ‰§è¡Œå™¨
- `ScenarioTrigger`: åœºæ™¯è§¦å‘å™¨

### 8. ScenarioDialogueService (åœºæ™¯å¯¹è¯æœåŠ¡)

**æ–‡ä»¶**: `core/scenario/scenario_dialogue_service.py`

**æ ¸å¿ƒèŒè´£**:
- å¤„ç†åœºæ™¯å¯¹è¯æµç¨‹
- ç®¡ç†å¯¹è¯ä¼šè¯

**å…³é”®ç±»**:
- `ScenarioDialogueService`: åœºæ™¯å¯¹è¯æœåŠ¡
- `DialogueSession`: å¯¹è¯ä¼šè¯

## ğŸ”„ å®Œæ•´æ•°æ®æµå›¾

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·
    participant Conn as ConnectionHandler
    participant Intent as IntentHandler
    participant Status as ChatStatusManager
    participant Teaching as TeachingHandler
    participant Redis as Redis
    participant API as ç®¡ç†API
    participant TTS as TTSç³»ç»Ÿ

    User->>Conn: WebSocketè¿æ¥
    Conn->>Conn: åˆå§‹åŒ–ç»„ä»¶
    Conn->>Conn: åŠ è½½ç”¨æˆ·ä¿¡æ¯
    Conn->>User: å‘é€æ¬¢è¿è¯­éŸ³
    
    User->>Conn: è¯´è¯ï¼ˆéŸ³é¢‘ï¼‰
    Conn->>Conn: ASRè¯†åˆ«
    Conn->>Intent: handle_user_intent
    
    alt åœºæ™¯è§¦å‘
        Intent->>Status: handle_user_input
        Status->>Redis: æ£€æŸ¥èŠå¤©çŠ¶æ€
        alt é¦–æ¬¡è§¦å‘
            Status->>API: è·å–åœºæ™¯é…ç½®
            Status->>Redis: åˆ›å»ºä¼šè¯æ•°æ®
            Status->>Teaching: è¿”å›start_teaching
            Teaching->>API: è·å–ç¬¬ä¸€æ­¥æ¶ˆæ¯
            Teaching->>TTS: å‘é€æ¶ˆæ¯åˆ—è¡¨
        else å·²åœ¨æ•™å­¦
            Status->>Redis: è·å–ä¼šè¯æ•°æ®
            Status->>API: è·å–å½“å‰æ­¥éª¤
            Status->>Status: è¯„ä¼°ç”¨æˆ·å›å¤
            Status->>Redis: æ›´æ–°ä¼šè¯æ•°æ®
            Status->>Teaching: è¿”å›actionç»“æœ
            Teaching->>TTS: å‘é€ç›¸åº”æ¶ˆæ¯
        end
    else è‡ªç”±èŠå¤©
        Intent->>Conn: ç»§ç»­æ­£å¸¸æµç¨‹
        Conn->>LLM: è°ƒç”¨LLM
        Conn->>TTS: å‘é€å›å¤
    end
    
    TTS->>User: æ’­æ”¾AIå›å¤
```

## ğŸ“Š çŠ¶æ€ç®¡ç†æµç¨‹å›¾

```mermaid
stateDiagram-v2
    [*] --> FreeMode: åˆå§‹çŠ¶æ€
    
    FreeMode --> TeachingMode: åœºæ™¯è§¦å‘/æ¨¡å¼åˆ‡æ¢
    
    TeachingMode --> WaitingResponse: å‘é€ç¬¬ä¸€æ­¥æ¶ˆæ¯
    WaitingResponse --> Evaluating: ç”¨æˆ·å›å¤
    Evaluating --> Evaluating: è¯„ä¼°ä¸­
    
    Evaluating --> PerfectMatch: å®Œå…¨åŒ¹é…(score>=90)
    Evaluating --> PartialMatch: éƒ¨åˆ†åŒ¹é…(60<=score<90)
    Evaluating --> NoMatch: å®Œå…¨ä¸åŒ¹é…(score<60)
    
    PerfectMatch --> NextStep: è·³è½¬åˆ°ä¸‹ä¸€æ­¥
    PartialMatch --> NextStep: è·³è½¬åˆ°ä¸‹ä¸€æ­¥
    NoMatch --> NextStep: è·³è½¬åˆ°ä¸‹ä¸€æ­¥
    
    NextStep --> WaitingResponse: å‘é€ä¸‹ä¸€æ­¥æ¶ˆæ¯
    NextStep --> Completed: æ‰€æœ‰æ­¥éª¤å®Œæˆ
    NextStep --> RetryStep: å¶å­èŠ‚ç‚¹é‡è¯•
    
    RetryStep --> WaitingResponse: é‡å¤å½“å‰æ­¥éª¤
    
    Completed --> FreeMode: åˆ‡æ¢åˆ°è‡ªç”±æ¨¡å¼
    
    TeachingMode --> FreeMode: æ‰‹åŠ¨åˆ‡æ¢
    FreeMode --> FreeMode: è‡ªç”±èŠå¤©
```

## ğŸ”‘ å…³é”®æ•°æ®ç»“æ„

### Redisä¼šè¯æ•°æ®
```json
{
  "session_id": "teaching_{user_id}",
  "scenario_id": "scenario_123",
  "scenario_name": "åœºæ™¯åç§°",
  "current_step": 0,
  "total_steps": 5,
  "start_time": 1234567890,
  "waiting_for_response": true,
  "wait_start_time": 1234567890,
  "evaluations": [
    {
      "score": 100,
      "is_passed": true,
      "feedback": "å›ç­”å®Œå…¨æ­£ç¡®ï¼",
      "user_input": "æˆ‘æ¸´äº†",
      "expected_phrases": ["æ¸´äº†", "æˆ‘æ¸´"],
      "expected_keywords": [],
      "max_phrase_similarity": 0
    }
  ],
  "total_user_replies": 1,
  "max_user_replies": 3,
  "warning_sent": false,
  "current_step_retry_count": 0
}
```

### èŠå¤©çŠ¶æ€ï¼ˆRedis Keyï¼‰
```
setting:chat_status:{user_id} â†’ "teaching_mode" | "free_mode"
```

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 1. åœºæ™¯è§¦å‘æ£€æµ‹
- **ä½ç½®**: `dialogue_executor.py:227` (ScenarioTrigger)
- **åŠŸèƒ½**: æ£€æµ‹ç”¨æˆ·è¾“å…¥æ˜¯å¦è§¦å‘åœºæ™¯
- **è§¦å‘æ¡ä»¶**: åŒ¹é…åœºæ™¯çš„å…³é”®è¯æˆ–çŸ­è¯­

### 2. ç”¨æˆ·å›å¤è¯„ä¼°
- **ä½ç½®**: `chat_status_manager.py:900` (_evaluate_response_with_config)
- **åŠŸèƒ½**: è¯„ä¼°ç”¨æˆ·å›å¤æ˜¯å¦ç¬¦åˆæœŸæœ›
- **è¯„ä¼°æ–¹å¼**: æ–‡å­—åŒ¹é… + æ‹¼éŸ³åŒ¹é…
- **è¯„åˆ†**: å®Œå…¨åŒ¹é…(100) / éƒ¨åˆ†åŒ¹é…(70) / å®Œå…¨ä¸åŒ¹é…(0)

### 3. æ­¥éª¤è·³è½¬é€»è¾‘
- **ä½ç½®**: `chat_status_manager.py:585` (_process_teaching_response)
- **åŠŸèƒ½**: æ ¹æ®è¯„ä¼°ç»“æœå†³å®šä¸‹ä¸€æ­¥
- **è·³è½¬è§„åˆ™**: 
  - å®Œå…¨åŒ¹é… â†’ perfectMatchNextStepId
  - éƒ¨åˆ†åŒ¹é… â†’ partialMatchNextStepId
  - å®Œå…¨ä¸åŒ¹é… â†’ noMatchNextStepId

### 4. TTSæ¶ˆæ¯å‘é€
- **ä½ç½®**: `teaching_handler.py:331` (_send_tts_message)
- **åŠŸèƒ½**: å‘é€å•æ¡TTSæ¶ˆæ¯
- **æµç¨‹**: FIRST â†’ MIDDLE â†’ LAST â†’ ç­‰å¾…æ’­æ”¾å®Œæˆ

### 5. æ¶ˆæ¯åˆ—è¡¨å‘é€
- **ä½ç½®**: `teaching_handler.py:400` (_send_message_list)
- **åŠŸèƒ½**: å‘é€å¤šæ¡æ¶ˆæ¯ï¼ˆæ­¥éª¤æ¶ˆæ¯åˆ—è¡¨ï¼‰
- **ç‰¹ç‚¹**: æ¯æ¡æ¶ˆæ¯ç‹¬ç«‹å‘é€ï¼Œæœ€åä¸€æ¡è®¾ç½®llm_finish_task

## ğŸ“ æ¨¡å—é—´ä¾èµ–å…³ç³»

```
ConnectionHandler
â”œâ”€â”€ TeachingHandler
â”‚   â””â”€â”€ ChatStatusManager
â”‚       â”œâ”€â”€ DialogueService
â”‚       â”‚   â””â”€â”€ API
â”‚       â”œâ”€â”€ Redis
â”‚       â””â”€â”€ ScenarioManager
â”‚           â””â”€â”€ API
â””â”€â”€ VAD/ASR/TTS/LLM/Memory/Intent

DialogueExecutor
â”œâ”€â”€ ScenarioManager
â””â”€â”€ LearningRecordManager

ScenarioDialogueService
â”œâ”€â”€ ScenarioManager
â”œâ”€â”€ StepManager
â””â”€â”€ LearningRecordManager
```

## ğŸš€ ç³»ç»Ÿå·¥ä½œæµç¨‹

### åœºæ™¯1: é¦–æ¬¡è§¦å‘æ•™å­¦åœºæ™¯
```
1. ç”¨æˆ·è¯´è¯ â†’ ASRè¯†åˆ«
2. IntentHandleræ£€æµ‹åœºæ™¯è§¦å‘
3. ChatStatusManager.handle_user_input
4. _start_teaching_session
   - ä»APIè·å–åœºæ™¯é…ç½®
   - åˆ›å»ºRedisä¼šè¯æ•°æ®
   - è·å–ç¬¬ä¸€æ­¥æ¶ˆæ¯åˆ—è¡¨
5. TeachingHandlerå‘é€ç¬¬ä¸€æ­¥æ¶ˆæ¯
6. è®¾ç½®ç­‰å¾…ç”¨æˆ·å“åº”çŠ¶æ€
```

### åœºæ™¯2: å¤„ç†ç”¨æˆ·å›å¤
```
1. ç”¨æˆ·è¯´è¯ â†’ ASRè¯†åˆ«
2. ChatStatusManager.handle_user_input
3. _process_teaching_response
   - ä»APIè·å–åœºæ™¯æ­¥éª¤
   - ä½¿ç”¨Redisä¸­çš„current_stepè·å–å½“å‰æ­¥éª¤
   - è¯„ä¼°ç”¨æˆ·å›å¤
   - å†³å®šä¸‹ä¸€æ­¥åŠ¨ä½œ
4. æ›´æ–°Redisä¼šè¯æ•°æ®
5. TeachingHandleræ ¹æ®actionå‘é€æ¶ˆæ¯
6. è®¾ç½®llm_finish_task = True
7. ç­‰å¾…TTSæ’­æ”¾å®Œæˆ
```

### åœºæ™¯3: æ•™å­¦å®Œæˆ
```
1. æ‰€æœ‰æ­¥éª¤å®Œæˆ OR è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°
2. è®¡ç®—æœ€ç»ˆå¾—åˆ†
3. ä¿å­˜å­¦ä¹ è®°å½•
4. åˆ‡æ¢åˆ°è‡ªç”±æ¨¡å¼
5. åˆ é™¤Redisä¼šè¯æ•°æ®
6. å‘é€å®Œæˆæ¶ˆæ¯å’Œè‡ªç”±èŠå¤©æ¬¢è¿
```

## ğŸ“Œ å…³é”®è®¾è®¡æ¨¡å¼

1. **çŠ¶æ€ç®¡ç†æ¨¡å¼**: ä½¿ç”¨Rediså­˜å‚¨èŠå¤©çŠ¶æ€å’Œä¼šè¯æ•°æ®
2. **è´£ä»»é“¾æ¨¡å¼**: IntentHandler â†’ ChatStatusManager â†’ TeachingHandler
3. **ç­–ç•¥æ¨¡å¼**: ä¸åŒåŒ¹é…ç±»å‹ä½¿ç”¨ä¸åŒçš„è·³è½¬ç­–ç•¥
4. **è§‚å¯Ÿè€…æ¨¡å¼**: TTSæ¶ˆæ¯å‘é€åç­‰å¾…æ’­æ”¾å®Œæˆ

